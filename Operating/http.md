## HTTP协议

### 什么是HTTP

HTTP协议是最为广泛的一种网络协议，叫超文本传输协议(HyperText Transport Protocol)。所有的万维网客户端与万维网服务端之间的交互都需要遵循HTTP协议。HTTP协议是属于 **面向事务** 的应用层协议，使用TCP连接进行可靠的传输，其默认端口是80。**需要注意的是**：HTTP协议传输的数据是未加密的，也就明文的，对传输隐私信息非常不安全。

### HTTP工作原理

![HTTP工作原理](http://on64c9tla.bkt.clouddn.com/Comput/httpworkflow.png)

![HTTP请求过程](http://on64c9tla.bkt.clouddn.com/Comput/httprequest.png)

注意，HTTP协议使用面向连接的TCP作为传输层协议，保证了数据的可靠传输，但是，HTTP协议本身是 **无连接的**，而且是 **无状态的**，即同一个客户端访问同一个服务器多次，与第一次访问时一样的。

![HTTP请求文档](http://on64c9tla.bkt.clouddn.com/Comput/httpdoc.png)

**HTTP发展历程**

HTTP/1.0特性  
每一次请求都需要两倍的RTT开销，这种 **非持续连接** 使得服务器的负担很重。

HTTP/1.1特性  
保证了客户端与服务器端的 **持续连接**，即服务器在发送响应后仍然在一段时间内保持这条连接。HTTP/1.1协议的持续连接的两种方式：**非流水线方式** 和 **流水线方式**。

非流水线方式的特点，客户端在收到前一个响应后才能发出下一个请求，省去了建立TCP连接所需的一个RTT时间，但造成了服务器端的资源浪费。流水线方式的特点，客户端可以在收到报文响应之前就能够发送新的请求报文，使得TCP连接的空闲时间减少，提高了文档下载效率。

### 什么是HTTPS

通过SSL(Secure Socket Layer)协议对HTTP协议传输的数据进行加密，从而保证数据的安全性，这就是HTTPS协议。之后，SSL协议升级，出现TLS(Transport Layer Security)，现在HTTPS协议都是用的TLS协议。

### HTTPS工作原理

HTTPS在传输数据之前需要客户端（浏览器）与服务端（网站）之间进行一次握手，在握手过程中将 **确立双方加密传输数据的密码信息**。TLS/SSL协议中使用了非对称加密，对称加密以及HASH算法。握手过程的简单描述如下：

(1)浏览器将自己支持的一套 **加密规则** 发送给网站。  

(2)网站从中选出一组 **加密算法与HASH算法**，并将自己的身份信息以 **证书** 的形式发回给浏览器。证书包含了网站地址，加密公钥，以及证书的颁发机构等信息。

(3)获得网站证书之后浏览器要做以下工作：  

a) **验证证书的合法性**（颁发证书的机构是否合法，证书中包含的网站地址是否与正在访问的地址一致等），如果证书受信任，则浏览器栏里面会显示一个小锁头，否则会给出证书不受信的提示。

b) 如果证书受信任，或者是用户接受了不受信的证书，浏览器会生成一串 **随机数的密码**，并用证书中提供的 **公钥加密**。

c) 使用约定好的HASH计算握手消息，并使用生成的随机数对消息进行加密，最后将之前生成的所有信息发送给网站。

(4)网站接收浏览器发来的数据之后要做以下的操作：

a) 使用自己的 **私钥对信息解密取出密码**，使用密码解密浏览器发来的握手消息，并验证HASH是否与浏览器发来的一致。

b) 使用密码加密一段握手消息，发送给浏览器。

(5)浏览器解密并计算握手消息的HASH，如果与服务端发来的HASH一致，此时握手过程结束。之后所有的通信数据将由之前浏览器生成的随机密码并利用对称加密算法进行加密。

这里浏览器与网站互相发送加密的握手消息并验证，目的是为了保证双方都获得了一致的密码，并且可以正常的加密解密数据，为后续真正数据的传输做一次测试。HTTPS一般使用的加密与HASH算法如下：

非对称加密算法：RSA，DSA/DSS  
对称加密算法：AES，RC4，3DES  
HASH算法：MD5，SHA1，SHA256  

其中 **非对称加密算法用于在握手过程中加密生成的密码**，**对称加密算法用于对真正传输的数据进行加密**，而 **HASH算法用于验证数据的完整性**。

由于浏览器生成的密码是整个数据加密的关键，因此在传输的时候使用了非对称加密算法对其加密。非对称加密算法会生成公钥和私钥，公钥只能用于加密数据，因此可以随意传输，而网站的私钥用于对数据进行解密，所以网站都会非常小心的保管自己的私钥，防止泄漏。
